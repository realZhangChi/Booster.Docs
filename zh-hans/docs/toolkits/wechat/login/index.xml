<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Maui.Toolkit – 登录及标识</title><link>https://docs.mauitoolkit.com/zh-hans/docs/toolkits/wechat/login/</link><description>Recent content in 登录及标识 on Maui.Toolkit</description><generator>Hugo -- gohugo.io</generator><lastBuildDate>Thu, 14 Oct 2021 00:00:00 +0000</lastBuildDate><atom:link href="https://docs.mauitoolkit.com/zh-hans/docs/toolkits/wechat/login/index.xml" rel="self" type="application/rss+xml"/><item><title>Docs: 登录</title><link>https://docs.mauitoolkit.com/zh-hans/docs/toolkits/wechat/login/login/</link><pubDate>Thu, 21 Oct 2021 00:00:00 +0000</pubDate><guid>https://docs.mauitoolkit.com/zh-hans/docs/toolkits/wechat/login/login/</guid><description>
&lt;div class="pageinfo pageinfo-primary">
&lt;p>首先请阅读&lt;a href="https://docs.mauitoolkit.com/zh-hans/docs/toolkits/wechat/get-started/#%E9%85%8D%E7%BD%AE">开始使用&lt;/a>章节确保完成与微信交互所需的配置。&lt;/p>
&lt;/div>
&lt;p>在移动应用中，调用微信登录将唤起微信APP并请求用户授权；在桌面应用中，将访问微信网页应用授权网址以展示二维码。&lt;/p>
&lt;h2 id="开始使用">开始使用&lt;/h2>
&lt;p>Maui.Toolkit.WeChat 在&lt;code>IAuthorizationService&lt;/code>接口中定义了微信登录，它位于&lt;code>Maui.Toolkit.WeChat.Services.Identity&lt;/code>名称空间。&lt;/p>
&lt;p>注入接口&lt;code>IAuthorizationService&lt;/code>并调用&lt;code>AuthorizeAsync()&lt;/code>方法，即可唤起微信登录。&lt;/p>
&lt;p>一般地，了解以上知识即可通过Maui.Toolkit.WeChat使用微信登录，Maui.Toolkit.WeChat将会自动处理登录回调并从微信获取用户信息。&lt;/p>
&lt;h2 id="回调">回调&lt;/h2>
&lt;p>用户在微信中授权登录后，将携带授权码回调到Maui应用程序中。接收到回调请求后，将自动调用&lt;code>IAuthorizationService&lt;/code>上的&lt;code>AuthorizeCallbackAsync&lt;/code>方法来完成通过微信登录及后续步骤。&lt;/p>
&lt;pre>&lt;code>public virtual async Task AuthorizeCallbackAsync(string appId, string appSecret, string code)
{
// 一些前置卫语句...
var token = await _weChatHttpClient.GetTokenAsync(appId, appSecret, code);
token.IssuedAt = DateTimeOffset.UtcNow.ToUnixTimeSeconds();
await _tokenStore.SetAsync(token);
var userInfo = await _weChatHttpClient.GetUserInfoAsync(token.AccessToken, token.OpenId);
await _userInfoStore.SetAsync(userInfo);
}
&lt;/code>&lt;/pre>
&lt;p>在回调方法中，首先会根据微信的授权码去获取Token，记录Token的颁发时间后将其保存到&lt;code>ITokenStore&lt;/code>中。然后获取微信用户的个人信息，并保存到&lt;code>IUserInfoStore&lt;/code>中。&lt;/p>
&lt;h2 id="下一步">&lt;strong>下一步&lt;/strong>&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="docs/toolkits/wechat/login/user-info/">用户信息&lt;/a>：通过&lt;code>IUserInfoStore&lt;/code>获取用户信息&lt;/li>
&lt;/ul></description></item><item><title>Docs: 用户信息</title><link>https://docs.mauitoolkit.com/zh-hans/docs/toolkits/wechat/login/user-info/</link><pubDate>Thu, 21 Oct 2021 00:00:00 +0000</pubDate><guid>https://docs.mauitoolkit.com/zh-hans/docs/toolkits/wechat/login/user-info/</guid><description>
&lt;p>TODO&amp;hellip;&lt;/p></description></item><item><title>Docs: 自定义</title><link>https://docs.mauitoolkit.com/zh-hans/docs/toolkits/wechat/login/custom/</link><pubDate>Thu, 21 Oct 2021 00:00:00 +0000</pubDate><guid>https://docs.mauitoolkit.com/zh-hans/docs/toolkits/wechat/login/custom/</guid><description>
&lt;p>TODO&amp;hellip;&lt;/p></description></item></channel></rss>